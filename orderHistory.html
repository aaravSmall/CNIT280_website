<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Order History</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f4f4f9; color:#333; }
    header { background:#3b5d5b; color:white; padding:15px; text-align:center; }
    nav { display:flex; justify-content:center; background:#ece0d7; padding:10px; gap:12px; }
    nav a { text-decoration:none; font-weight:bold; color:#31333e; }
    .container { max-width:900px; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.08); }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#3b5d5b; color:white; }
    button { background:#3b5d5b; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>
  <header><h1>Your Order History</h1></header>
  <nav id="navBar"></nav>

  <div class="container">
    <table>
      <thead><tr><th>Date</th><th>Customer Name</th><th>Type</th><th>Attendance</th><th>Rating</th><th>Status</th></tr></thead>
      <tbody id="ordersBody"></tbody>
    </table>
    <p id="noOrders" style="text-align:center; margin-top:12px;">No orders yet.</p>
  </div>

  <script>
    // Access control
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if(!currentUser){
      alert('Please login.');
      window.location.href='login.html';
    }

    function logout(){
      localStorage.removeItem('currentUser');
      window.location.href='login.html';
    }

    // Dynamic navbar builder
    function buildNavBar(user){
      const nav = document.getElementById('navBar');
      nav.innerHTML = '';
      const links = [{text:'Home', href:'homePage.html'}];

      if(user.role==='customer'){
        links.push({text:'Place an Order', href:'orderForm.html'});
        links.push({text:'Calendar', href:'calendar.html'});
        links.push({text:'Order History', href:'orderHistory.html'});
      } else if(user.role==='admin'){
        links.push({text:'Calendar', href:'calendar.html'});
        links.push({text:'Admin Dashboard', href:'adminDashboard.html'});
      } else if(user.role==='staff'){
        links.push({text:'Calendar', href:'calendar.html'});
        links.push({text:'Staff Dashboard', href:'staffDashboard.html'});
      }

      links.push({text:'Logout', href:'#', onclick:'logout()'});

      links.forEach(link=>{
        const a = document.createElement('a');
        a.textContent = link.text;
        if(link.href) a.href = link.href;
        if(link.onclick) a.onclick = () => { window[link.onclick.replace('()','')](); return false; };
        nav.appendChild(a);
      });
    }

    buildNavBar(currentUser);

    // Only customers can access order history
    if(currentUser.role !== 'customer'){
      alert('Access denied. Customers only.');
      window.location.href='login.html';
    }

    // Load order history
    function loadHistory(){
      const orders = JSON.parse(localStorage.getItem('orders')||'[]');
      const myOrders = orders.filter(o => o.customer === currentUser.username);
      const tbody = document.getElementById('ordersBody');
      tbody.innerHTML = '';
      if(!myOrders.length){
        document.getElementById('noOrders').style.display='block';
        return;
      }
      document.getElementById('noOrders').style.display='none';
      myOrders.forEach(o=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${o.date}</td>
          <td>${o.name}</td>
          <td>${o.type}</td>
          <td>${o.attendance||0}</td>
          <td>${o.rating||0}</td>
          <td>${o.status}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    loadHistory();
  </script>
</body>
</html>
